"""
–í—Å–µ —Ñ—É–Ω–∫—Ü–∏–∏ –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å DeepSeek –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å –≤ —ç—Ç–æ–º —Ñ–∞–π–ª–µ.
–¢—É—Ç –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ—Ç—Å—è DeepSeek –∏ —Ñ—É–Ω–∫—Ü–∏—è –¥–ª—è –ø–µ—Ä–µ–ø–∏—Å—ã–≤–∞–Ω–∏—è —Ç–µ–∫—Å—Ç–∞ —á–µ—Ä–µ–∑ –Ω–µ–≥–æ.
–í–æ–∑–≤—Ä–∞—â–∞–µ–º –ø–µ—Ä–µ–ø–∏—Å–∞–Ω–Ω—ã–π —Ç–µ–∫—Å—Ç.
"""
import os
from dotenv import load_dotenv
from openai import OpenAI
from loguru import logger

# --- DeepSeek Initialization ---
load_dotenv()
deepseek_token = os.getenv("DEEPSEEK_TOKEN")
if not deepseek_token:
    raise ValueError("–ù–µ –Ω–∞–π–¥–µ–Ω —Ç–æ–∫–µ–Ω DEEPSEEK_TOKEN –≤ .env —Ñ–∞–π–ª–µ")

client = OpenAI(api_key=deepseek_token, base_url="https://api.deepseek.com")

SYSTEM_PROMPT = """
–¢—ã ‚Äî AI-—Ä–µ–¥–∞–∫—Ç–æ—Ä, —ç–∫—Å–ø–µ—Ä—Ç –ø–æ —Ä–µ—Ä–∞–π—Ç–∏–Ω–≥—É –Ω–æ–≤–æ—Å—Ç–Ω—ã—Ö —Ç–µ–∫—Å—Ç–æ–≤. 
–¢–≤–æ—è –∑–∞–¥–∞—á–∞ ‚Äî –ø–µ—Ä–µ–ø–∏—Å–∞—Ç—å –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª–µ–Ω–Ω—ã–π —Ç–µ–∫—Å—Ç, —Å–æ–±–ª—é–¥–∞—è —Å–ª–µ–¥—É—é—â–∏–µ –ø—Ä–∞–≤–∏–ª–∞:
1.  **–°–æ—Ö—Ä–∞–Ω–∏ –æ—Å–Ω–æ–≤–Ω–æ–π —Å–º—ã—Å–ª**: –í—Å–µ –∫–ª—é—á–µ–≤—ã–µ —Ñ–∞–∫—Ç—ã, –∏–º–µ–Ω–∞, —Ü–∏—Ñ—Ä—ã –∏ —Å–æ–±—ã—Ç–∏—è –¥–æ–ª–∂–Ω—ã –æ—Å—Ç–∞—Ç—å—Å—è –±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π.
2.  **–°–¥–µ–ª–∞–π —Ç–µ–∫—Å—Ç —É–Ω–∏–∫–∞–ª—å–Ω—ã–º**: –ò—Å–ø–æ–ª—å–∑—É–π –¥—Ä—É–≥–∏–µ —Ñ–æ—Ä–º—É–ª–∏—Ä–æ–≤–∫–∏, —Å–∏–Ω–æ–Ω–∏–º—ã –∏ —Å—Ç—Ä—É–∫—Ç—É—Ä—É –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–π.
3.  **–°—Ç–∏–ª—å –¥–ª—è Telegram**: –¢–µ–∫—Å—Ç –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –Ω–∞–ø–∏—Å–∞–Ω –≤ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–æ–Ω–Ω–æ–º, –ª–µ–≥–∫–æ —á–∏—Ç–∞–µ–º–æ–º —Å—Ç–∏–ª–µ, –ø–æ–¥—Ö–æ–¥—è—â–µ–º –¥–ª—è –Ω–æ–≤–æ—Å—Ç–Ω–æ–≥–æ Telegram-–∫–∞–Ω–∞–ª–∞.
4.  **–ù–∏—á–µ–≥–æ –ª–∏—à–Ω–µ–≥–æ**: –í –æ—Ç–≤–µ—Ç–µ –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –¢–û–õ–¨–ö–û –ø–µ—Ä–µ–ø–∏—Å–∞–Ω–Ω—ã–π —Ç–µ–∫—Å—Ç. –ù–µ –¥–æ–±–∞–≤–ª—è–π –æ—Ç —Å–µ–±—è –Ω–∏–∫–∞–∫–∏—Ö –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–µ–≤, –ø—Ä–∏–≤–µ—Ç—Å—Ç–≤–∏–π –∏–ª–∏ –∑–∞–∫–ª—é—á–µ–Ω–∏–π –≤—Ä–æ–¥–µ '–í–æ—Ç –ø–µ—Ä–µ–ø–∏—Å–∞–Ω–Ω—ã–π —Ç–µ–∫—Å—Ç:'.
5.  **–°–æ—Ö—Ä–∞–Ω—è–π —Ç–æ–Ω**: –ï—Å–ª–∏ –∏—Å—Ö–æ–¥–Ω—ã–π —Ç–µ–∫—Å—Ç –Ω–µ–π—Ç—Ä–∞–ª—å–Ω—ã–π, –ø–µ—Ä–µ–ø–∏—Å–∞–Ω–Ω—ã–π —Ç–æ–∂–µ –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –Ω–µ–π—Ç—Ä–∞–ª—å–Ω—ã–º.
"""

def rewrite_text_deepseek(text_to_rewrite: str) -> str | None:
    """
    –û—Ç–ø—Ä–∞–≤–ª—è–µ—Ç —Ç–µ–∫—Å—Ç –≤ DeepSeek –¥–ª—è –ø–µ—Ä–µ–ø–∏—Å—ã–≤–∞–Ω–∏—è.
    –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç –ø–µ—Ä–µ–ø–∏—Å–∞–Ω–Ω—ã–π —Ç–µ–∫—Å—Ç –∏–ª–∏ None –≤ —Å–ª—É—á–∞–µ –æ—à–∏–±–∫–∏.
    """
    try:
        response = client.chat.completions.create(
            model="deepseek-chat",
            messages=[
                {"role": "system", "content": SYSTEM_PROMPT},
                {"role": "user", "content": text_to_rewrite},
            ],
            temperature=1,
            max_tokens=1024,
            stream=False,
        )
        if response and response.choices:
            return response.choices[0].message.content.strip()
    except Exception as e:
        logger.error(f"‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ –æ–±—Ä–∞—â–µ–Ω–∏–∏ –∫ DeepSeek: {e}")
    return None

if __name__ == "__main__":
    # –ü—Ä–∏–º–µ—Ä —Ç–µ—Å—Ç–∞
    test_text = "–ö–æ–º–ø–∞–Ω–∏—è '–¢–µ—Ö–Ω–æ-–ü—Ä–æ—Ä—ã–≤' –æ–±—ä—è–≤–∏–ª–∞ –æ –≤—ã–ø—É—Å–∫–µ –Ω–æ–≤–æ–≥–æ —Å–º–∞—Ä—Ç—Ñ–æ–Ω–∞ '–ì–∞–ª–∞–∫—Ç–∏–∫–∞-25', –∫–æ—Ç–æ—Ä—ã–π –æ—Å–Ω–∞—â–µ–Ω –∏–Ω–Ω–æ–≤–∞—Ü–∏–æ–Ω–Ω—ã–º –≥–æ–ª–æ–≥—Ä–∞—Ñ–∏—á–µ—Å–∫–∏–º –¥–∏—Å–ø–ª–µ–µ–º –∏ –±–∞—Ç–∞—Ä–µ–µ–π –Ω–∞ 100 —á–∞—Å–æ–≤ —Ä–∞–±–æ—Ç—ã. –ü—Ä–æ–¥–∞–∂–∏ —Å—Ç–∞—Ä—Ç—É—é—Ç 1 —Å–µ–Ω—Ç—è–±—Ä—è –ø–æ —Ü–µ–Ω–µ 999 –¥–æ–ª–ª–∞—Ä–æ–≤."
    print("üìù –ò—Å—Ö–æ–¥–Ω—ã–π —Ç–µ–∫—Å—Ç:\n", test_text)
    rewritten = rewrite_text_deepseek(test_text)
    if rewritten:
        print("\n‚úÖ –ü–µ—Ä–µ–ø–∏—Å–∞–Ω–Ω—ã–π —Ç–µ–∫—Å—Ç (DeepSeek):\n", rewritten)
    else:
        print("\n‚ùå –ù–µ —É–¥–∞–ª–æ—Å—å –ø–µ—Ä–µ–ø–∏—Å–∞—Ç—å —Ç–µ–∫—Å—Ç —á–µ—Ä–µ–∑ DeepSeek.") 